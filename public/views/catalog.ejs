<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupremeCoffee</title>
    <link rel="stylesheet" href="/css/main-styles.css">
</head>
<body>
 
    <header>
        <a class="logo" href="/register">SupremeCoffee</a>
        <div class="search-container">
            <form id="search-form" method="GET" action="/catalog/search">
                <input type="text" id="search-query" name="text" placeholder="–ø–æ–∏—Å–∫" >
                <button type="submit">–ü–æ–∏—Å–∫</button>
            </form>
            <div>
            <button>–∑–∞ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è–º —Ü—ñ–Ω–∏</button>
            <button>–ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</button>
            <button>–∑–∞ –≤–∞–≥–æ—é</button>
            <button>–∑–∞ –Ω–∞–∑–≤–æ—é</button>
    </div>
        </div>
        <div class="header-icons">
            <img src="/images/img1/basket.png" alt="Cart Icon" class="icon"id="cart-icon">
            <img class="avatar" src="<%= imgPath ? imgPath.replace('public/', '/') : '/images/user_img/user.png' %>" alt="User Icon" class="icon" id="user-icon">
        </div>
    </header>

    <aside class="filters">
        <h4>–¶–µ–Ω–∞</h4>
        <input type="text" class="bor" id="minPrice" placeholder="0" > -
        <input type="text" class="bor" id="maxPrice" placeholder="10000">
        <button id="applyPrice">OK</button>
        
        <hr class="hr1">
        <h4>–í–∞–≥–∞</h4>
        <input type="text" class="bor" id="minWeight" placeholder="0" > -
        <input type="text" class="bor" id="maxWeight" placeholder="5000">
        <button id="applyWeight">OK</button>

        <hr class="hr1">
        <h4>–ü–æ–∏—Å–∫ –∑–∞ –∫—Ä–∞—ó–Ω–æ—é</h4>
        <ul>
            <% uniqueCountries.forEach(country => { %>
                <li>
                    <input type="checkbox" name="origin" value="<%= country %>"> <%= country %>
                </li>
            <% }) %>
        </ul>
    
        <hr class="hr1">
        <h4>–í–∏–¥ –∫–∞–≤–∏</h4>
        <ul>
            <li><input type="checkbox" name="type" value="bean"> –ó–µ—Ä–Ω–æ</li>
            <li><input type="checkbox" name="type" value="ground"> –ú–æ–ª–æ—Ç–∞</li>
        </ul>
    
        <hr class="hr1">
        <h4>–°–∫–ª–∞–¥ –∫–∞–≤–∏</h4>
        <ul>
            <li><input type="checkbox" name="composition" value="arabica"> –ê—Ä–∞–±—ñ–∫–∞</li>
            <li><input type="checkbox" name="composition" value="robusta"> –†–æ–±—É—Å—Ç–∞</li>
        </ul>
        <hr class="hr1">
   <center>   <button id="resetFilters">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button></center>  
        <hr class="hr1">
    </aside>

    <main>
        <div class="products" id="products">
            <% if (message) { %>
                <p class="message"><%= message %></p>
            <% } %>
            <% coffees.forEach(coffee => { %>
                <div class="product" data-id="<%= coffee._id %>" data-name="<%= coffee.name %>">
                    <div class="product-image img-click">
                        <img src="/images/coffees_img/<%= coffee.imgPath.split('\\').pop() %>" alt="<%= coffee.name %>">
                    </div>
                    <div class="product-info">
                        <span class="product-name"><%= coffee.name %></span>
                        <span>–í–µ—Å: <%= coffee.netWeight %> –≥</span>
                        <span>–¢–∏–ø: <%= coffee.type === 'bean' ? '–ó–µ—Ä–Ω–æ' : '–ú–æ–ª–æ—Ç–∞—è' %></span>
                        <span>–°–æ—Å—Ç–∞–≤: <%= coffee.composition === 'arabica' ? '–ê—Ä–∞–±–∏–∫–∞' : '–†–æ–±—É—Å—Ç–∞' %></span>
                        <span class="product-price">–¶–µ–Ω–∞: <%= coffee.salePrice %> –≥—Ä–Ω</span>
                    </div>
                </div>
            <% }) %>
        </div>
    </main>
    

    <footer>
        <div class="footer-social">
            <span>üì∏ @SupremeCoffeeUA</span>
            <span>üìß SupremeCoffee@gmail.com</span>
            <span>üìû +380977415447</span>
        </div>
    </footer>

</body>
<script src="./js/catalog_product.js"></script>
<script src="./js/catalog_profile.js"></script>
<script src="./js/catalog_search.js"></script>
<script src="./js/catalog_cart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const filters = new URLSearchParams(window.location.search);

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function setFiltersFromURL() {
        const minPrice = filters.get('price')?.split('-')[0] || '';
        const maxPrice = filters.get('price')?.split('-')[1] || '';
        document.getElementById('minPrice').value = minPrice;
        document.getElementById('maxPrice').value = maxPrice;

        const minWeight = filters.get('weight')?.split('-')[0] || '';
        const maxWeight = filters.get('weight')?.split('-')[1] || '';
        document.getElementById('minWeight').value = minWeight;
        document.getElementById('maxWeight').value = maxWeight;

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤ –∏–∑ URL
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            const values = filters.getAll(checkbox.name).join(',').split(',');
            checkbox.checked = values.includes(checkbox.value);
        });
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ü–µ–Ω–µ
    document.getElementById('applyPrice').addEventListener('click', () => {
        const minPrice = document.getElementById('minPrice').value;
        const maxPrice = document.getElementById('maxPrice').value;
        if (minPrice || maxPrice) {
            filters.set('price', `${minPrice || 0}-${maxPrice || 10000}`);
        } else {
            filters.delete('price');
        }
        applyFilters();
    });

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –≤–µ—Å—É
    document.getElementById('applyWeight').addEventListener('click', () => {
        const minWeight = document.getElementById('minWeight').value;
        const maxWeight = document.getElementById('maxWeight').value;
        if (minWeight || maxWeight) {
            filters.set('weight', `${minWeight || 0}-${maxWeight || 5000}`);
        } else {
            filters.delete('weight');
        }
        applyFilters();
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            const name = checkbox.name;
            const selectedValues = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value);

            if (selectedValues.length) {
                filters.set(name, selectedValues.join(','));
            } else {
                filters.delete(name);
            }
            applyFilters();
        });
    });

    document.getElementById('resetFilters').addEventListener('click', () => {
    const currentUrl = new URL(window.location.href);
    
    // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
    currentUrl.search = '';
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ URL –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    window.location.href = currentUrl.toString();
});


    function applyFilters() {
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    const searchQuery = new URLSearchParams(window.location.search).get('text');
    if (searchQuery) {
        filters.set('text', searchQuery);
    }
    const url = `/catalog/filters?${filters.toString()}`;
    window.location.href = url;
}


    setFiltersFromURL(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
});

</script>

</html>
